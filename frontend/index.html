<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transkriptor – Lokale Spracherkennung</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <line x1="12" x2="12" y1="19" y2="22"/>
                    </svg>
                </div>
                <h1>Transkriptor</h1>
            </div>
            <div class="header-status">
                <button class="help-btn" id="helpBtn" title="Hilfe & Shortcuts">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                        <line x1="12" x2="12.01" y1="17" y2="17"/>
                    </svg>
                </button>
                <span class="status-dot" id="apiStatus"></span>
                <span class="status-text" id="apiStatusText">Verbinde...</span>
            </div>
        </header>

        <!-- Help Modal -->
        <div class="modal-overlay hidden" id="helpModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Hilfe & Shortcuts</h2>
                    <button class="modal-close" id="helpModalClose">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <section class="help-section">
                        <h3>Mehrfachauswahl</h3>
                        <div class="help-item">
                            <kbd>Klick</kbd>
                            <span>Segment auswählen</span>
                        </div>
                        <div class="help-item">
                            <kbd>Shift + Klick</kbd>
                            <span>Mehrere Segmente auswählen (Bereich)</span>
                        </div>
                        <div class="help-item">
                            <kbd>Strg + Klick</kbd>
                            <span>Einzelne Segmente hinzufügen/entfernen</span>
                        </div>
                        <p class="help-note">Nach der Auswahl erscheint eine Toolbar zum Zuweisen von Sprechern.</p>
                    </section>

                    <section class="help-section">
                        <h3>Audio-Player</h3>
                        <div class="help-item">
                            <kbd>Klick auf Segment</kbd>
                            <span>Audio ab dieser Stelle abspielen</span>
                        </div>
                        <div class="help-item">
                            <kbd>Leertaste</kbd>
                            <span>Play/Pause (wenn Player fokussiert)</span>
                        </div>
                    </section>

                    <section class="help-section">
                        <h3>Sprecher verwalten</h3>
                        <ul>
                            <li>Klicken Sie auf einen Sprecher-Namen, um ihn umzubenennen</li>
                            <li>Verwenden Sie das Dropdown bei jedem Segment, um den Sprecher zu ändern</li>
                            <li>Button "Sprecher hinzufügen" erstellt zusätzliche Sprecher</li>
                        </ul>
                    </section>

                    <section class="help-section">
                        <h3>Export</h3>
                        <ul>
                            <li><strong>TXT</strong> - Einfacher Text mit Sprecher-Namen</li>
                            <li><strong>SRT/VTT</strong> - Untertitel mit Zeitstempeln</li>
                            <li><strong>JSON</strong> - Alle Daten (inkl. Zeitstempel)</li>
                            <li><strong>Word</strong> - Formatiertes Dokument</li>
                        </ul>
                    </section>

                    <section class="help-section">
                        <h3>Datenpersistenz</h3>
                        <p>Ihre Arbeit wird automatisch gespeichert und bleibt 7 Tage erhalten.</p>
                    </section>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Upload Section -->
            <section class="upload-section" id="uploadSection">
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="17,8 12,3 7,8"/>
                            <line x1="12" x2="12" y1="3" y2="15"/>
                        </svg>
                    </div>
                    <h2>Audio oder Video hochladen</h2>
                    <p>Ziehe eine Datei hierher oder klicke zum Auswählen</p>
                    <p class="upload-formats">MP3, WAV, M4A, MP4, MKV, WEBM und mehr</p>
                    <input type="file" id="fileInput" accept="audio/*,video/*" hidden>
                </div>

                <!-- Options -->
                <div class="options-panel">
                    <div class="option-group">
                        <label for="languageSelect">Sprache</label>
                        <select id="languageSelect">
                            <option value="">Automatisch erkennen</option>
                            <option value="de">Deutsch</option>
                            <option value="en">English</option>
                            <option value="fr">Français</option>
                            <option value="es">Español</option>
                            <option value="it">Italiano</option>
                            <option value="nl">Nederlands</option>
                            <option value="pl">Polski</option>
                            <option value="pt">Português</option>
                            <option value="ru">Русский</option>
                            <option value="ja">日本語</option>
                            <option value="zh">中文</option>
                            <option value="ko">한국어</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="minSpeakers">Min. Sprecher</label>
                        <select id="minSpeakers">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="10">10</option>
                            <option value="12">12</option>
                            <option value="15" selected>15</option>
                            <option value="18">18</option>
                            <option value="20">20</option>
                        </select>
                    </div>
                    <div class="option-group">
                        <label for="maxSpeakers">Max. Sprecher</label>
                        <select id="maxSpeakers">
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="8">8</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="18">18</option>
                            <option value="20">20</option>
                            <option value="25" selected>25</option>
                            <option value="30">30</option>
                        </select>
                    </div>
                    <div class="option-group checkbox-group">
                        <label>
                            <input type="checkbox" id="diarizeCheck" checked>
                            <span class="checkbox-custom"></span>
                            Sprecher erkennen
                        </label>
                    </div>
                    <div class="option-group checkbox-group">
                        <label>
                            <input type="checkbox" id="wordTimestamps">
                            <span class="checkbox-custom"></span>
                            Wort-Zeitstempel
                        </label>
                    </div>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="progress-section hidden" id="progressSection">
                <div class="progress-content">
                    <div class="progress-spinner">
                        <svg viewBox="0 0 50 50">
                            <circle cx="25" cy="25" r="20" fill="none" stroke-width="4"/>
                        </svg>
                    </div>
                    <h2 id="progressTitle">Transkribiere...</h2>
                    <p id="progressText">Dies kann je nach Dateigröße einige Minuten dauern</p>
                    <div class="file-info">
                        <span class="file-name" id="fileName"></span>
                        <span class="file-size" id="fileSize"></span>
                    </div>
                </div>
            </section>

            <!-- Editor Section -->
            <section class="editor-section hidden" id="editorSection">
                <div class="editor-toolbar">
                    <div class="toolbar-left">
                        <button class="toolbar-btn" id="newTranscript" title="Neue Transkription">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 5v14M5 12h14"/>
                            </svg>
                            Neu
                        </button>
                    </div>
                    <div class="toolbar-right">
                        <div class="export-dropdown">
                            <button class="toolbar-btn primary" id="exportBtn">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" x2="12" y1="15" y2="3"/>
                                </svg>
                                Export
                            </button>
                            <div class="dropdown-menu" id="exportMenu">
                                <button data-format="txt">Text (.txt)</button>
                                <button data-format="srt">Untertitel (.srt)</button>
                                <button data-format="vtt">WebVTT (.vtt)</button>
                                <button data-format="json">JSON (.json)</button>
                                <button data-format="docx">Word (.docx)</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Audio Player -->
                <div class="audio-player-panel hidden" id="audioPlayerPanel">
                    <div class="audio-player-controls">
                        <button class="audio-play-btn" id="audioPlayBtn" title="Play/Pause">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="5 3 19 12 5 21 5 3"/>
                            </svg>
                        </button>
                        <div class="audio-time">
                            <span id="audioCurrentTime">00:00</span>
                            <span class="audio-separator">/</span>
                            <span id="audioDuration">00:00</span>
                        </div>
                        <input type="range" class="audio-seek" id="audioSeek" min="0" max="100" value="0">
                        <div class="audio-volume">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                                <path d="M15.54 8.46a5 5 0 0 1 0 7.07"/>
                            </svg>
                            <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
                        </div>
                    </div>
                    <audio id="audioPlayer" preload="metadata"></audio>
                </div>

                <!-- Editor Tabs -->
                <div class="editor-tabs">
                    <button class="tab-btn active" data-tab="transcript">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" x2="8" y1="13" y2="13"/>
                            <line x1="16" x2="8" y1="17" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        Transkript
                    </button>
                    <button class="tab-btn" data-tab="summary">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                            <line x1="9" y1="10" x2="15" y2="10"/>
                            <line x1="9" y1="14" x2="13" y2="14"/>
                        </svg>
                        Zusammenfassung
                    </button>
                </div>

                <!-- Tab Content -->
                <div class="tab-content">
                    <!-- Transcript Tab -->
                    <div class="tab-pane active" id="transcriptTab">
                        <!-- Speaker Name Editor -->
                <div class="speaker-panel" id="speakerPanel">
                    <div class="speaker-panel-header">
                        <h3>Sprecher benennen</h3>
                        <button class="add-speaker-btn" id="addSpeakerBtn" title="Sprecher hinzufügen">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                                <circle cx="8.5" cy="7" r="4"/>
                                <line x1="20" x2="20" y1="8" y2="14"/>
                                <line x1="23" x2="17" y1="11" y2="11"/>
                            </svg>
                            Sprecher hinzufügen
                        </button>
                    </div>
                    <div class="speaker-list" id="speakerList"></div>
                </div>

                <!-- Bulk Edit Toolbar -->
                <div class="bulk-edit-toolbar hidden" id="bulkEditToolbar">
                    <div class="bulk-edit-content">
                        <span class="bulk-edit-count" id="bulkEditCount">0 Segmente ausgewählt</span>
                        <div class="bulk-edit-actions">
                            <label>Sprecher zuweisen:</label>
                            <select id="bulkSpeakerSelect" class="bulk-speaker-select"></select>
                            <button class="toolbar-btn" id="bulkApplyBtn">Anwenden</button>
                            <button class="toolbar-btn" id="bulkCancelBtn">Abbrechen</button>
                        </div>
                    </div>
                </div>

                <!-- Transcript Editor -->
                <div class="transcript-editor" id="transcriptEditor">
                    <!-- Segments werden hier dynamisch eingefügt -->
                </div>

                <!-- Stats -->
                <div class="transcript-stats">
                    <span id="wordCount">0 Wörter</span>
                    <span id="segmentCount">0 Segmente</span>
                    <span id="duration">00:00:00</span>
                </div>
                    </div>
                    <!-- End Transcript Tab -->

                    <!-- Summary Tab -->
                    <div class="tab-pane hidden" id="summaryTab">
                        <!-- AI Summary Panel -->
                        <div class="summary-panel" id="summaryPanel">
                            <div class="summary-panel-header">
                                <h3>
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                                        <line x1="9" y1="10" x2="15" y2="10"/>
                                        <line x1="9" y1="14" x2="13" y2="14"/>
                                    </svg>
                                    KI-Zusammenfassung
                                </h3>
                                <div class="summary-controls">
                                    <select id="summaryType" class="summary-type-select">
                                        <option value="short">Kurze Übersicht (3-5 Sätze)</option>
                                        <option value="structured">Strukturierte Zusammenfassung</option>
                                        <option value="timeline">Zeitstempel-basiert</option>
                                        <option value="actions">Action Items / Aufgaben</option>
                                        <option value="tags">Tags / Schlagworte</option>
                                    </select>
                                    <button class="toolbar-btn primary" id="generateSummaryBtn">
                                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                            <polyline points="2 17 12 22 22 17"/>
                                            <polyline points="2 12 12 17 22 12"/>
                                        </svg>
                                        Generieren
                                    </button>
                                </div>
                            </div>
                            <div class="summary-content">
                                <div class="summary-placeholder" id="summaryPlaceholder">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                        <polyline points="2 17 12 22 22 17"/>
                                        <polyline points="2 12 12 17 22 12"/>
                                    </svg>
                                    <p>Wählen Sie einen Zusammenfassungstyp und klicken Sie auf "Generieren"</p>
                                </div>
                                <div class="summary-loading hidden" id="summaryLoading">
                                    <div class="summary-spinner">
                                        <svg viewBox="0 0 50 50">
                                            <circle cx="25" cy="25" r="20" fill="none" stroke-width="4"/>
                                        </svg>
                                    </div>
                                    <p>Generiere Zusammenfassung mit KI...</p>
                                </div>
                                <div class="summary-text hidden" id="summaryText"></div>
                            </div>
                            <div class="summary-actions hidden" id="summaryActions">
                                <button class="toolbar-btn" id="copySummaryBtn" title="In Zwischenablage kopieren">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
                                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
                                    </svg>
                                    Kopieren
                                </button>
                                <button class="toolbar-btn" id="exportSummaryBtn" title="Als Datei exportieren">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                        <polyline points="7,10 12,15 17,10"/>
                                        <line x1="12" x2="12" y1="15" y2="3"/>
                                    </svg>
                                    Exportieren
                                </button>
                                <button class="toolbar-btn" id="regenerateSummaryBtn" title="Neu generieren">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="23 4 23 10 17 10"/>
                                        <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
                                    </svg>
                                    Neu generieren
                                </button>
                            </div>
                        </div>
                    </div>
                    <!-- End Summary Tab -->
                </div>
                <!-- End Tab Content -->
            </section>
        </main>

        <!-- Toast Notifications -->
        <div class="toast-container" id="toastContainer"></div>
    </div>

    <script src="app.js"></script>
</body>
</html>
